<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ˜Ÿç©ºè®¸æ„¿ âœ¨</title>
    
    <!-- PWA é…ç½® -->
    <link rel="manifest" href="data:application/manifest+json;base64,eyJuYW1lIjoi5pif56m66K645oS/IEFwcCIsInNob3J0X25hbWUiOiLmmJ/nqbrorrjmhL8iLCJzdGFydF91cmwiOiIuIiwiZGlzcGxheSI6InN0YW5kYWxvbmUiLCJiYWNrZ3JvdW5kX2NvbG9yIjoiIzEyMGYyYSIsInRoZW1lX2NvbG9yIjoiIzhhMmJlMiIsImljb25zIjpbeyJzcmMiOiJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lJSGRwWkhSb1BTSXhPREFpSUdobGFXZG9kRDBpTVRnd0lqNDhjbVZqZENCM2FXUjBhRDBpTVRnd0lpQm9aV2xuYUhROUlqRTRNQ0lnWm1sc2JEMGlJekV5TUdZeVlTSXZQangwWlhoMElIZzlJamt3SWlCNVBTSTVNQ0lnWm1sc2JEMGlJM1ptWm1abUlpQjBaWGgwTFdGdVkyaHZjakFpYm1sa1pHeGxJajV6ZEdGeWNua2lMeTA4TDNSbGVIUStQQzl6ZG1jKyIsInR5cGUiOiJpbWFnZS9zdmcreG1sIiwic2l6ZXMiOiIxOTJ4MTkyIn1dfQ==">
    <meta name="theme-color" content="#8a2be2">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="æ˜Ÿç©ºè®¸æ„¿">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: radial-gradient(circle at 20% 80%, #120f2a 0%, #2a1b3d 40%, #1e0836 100%);
            min-height: 100vh;
            overflow: hidden;
            position: relative;
        }

        .stars {
            position: absolute;
            width: 100%;
            height: 100%;
            background: transparent;
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 2s infinite alternate;
        }

        .star.golden {
            background: #ffd700;
            box-shadow: 0 0 10px #ffd700;
        }

        @keyframes twinkle {
            0% { opacity: 0.3; transform: scale(0.8); }
            100% { opacity: 1; transform: scale(1.2); }
        }

        .shooting-star {
            position: absolute;
            width: 2px;
            height: 2px;
            background: #fff;
            border-radius: 50%;
            animation: shoot 3s linear infinite;
        }

        @keyframes shoot {
            0% {
                transform: translateX(0) translateY(0);
                opacity: 1;
            }
            100% {
                transform: translateX(300px) translateY(300px);
                opacity: 0;
            }
        }

        .container {
            position: relative;
            z-index: 10;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 2rem;
        }

        .title {
            color: #fff;
            font-size: 2.5rem;
            margin-bottom: 1rem;
            text-align: center;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from { text-shadow: 0 0 20px rgba(255, 255, 255, 0.5); }
            to { text-shadow: 0 0 30px rgba(255, 255, 255, 0.8), 0 0 40px rgba(138, 43, 226, 0.5); }
        }

        .subtitle {
            color: #ddd;
            font-size: 1.1rem;
            margin-bottom: 2rem;
            text-align: center;
            opacity: 0.9;
        }

        .moon {
            position: absolute;
            top: 10%;
            right: 10%;
            width: 80px;
            height: 80px;
            background: radial-gradient(circle at 30% 30%, #fff 0%, #f0f0f0 100%);
            border-radius: 50%;
            box-shadow: 0 0 30px rgba(255, 255, 255, 0.3);
            animation: moonGlow 3s ease-in-out infinite alternate;
        }

        @keyframes moonGlow {
            0% { box-shadow: 0 0 30px rgba(255, 255, 255, 0.3); }
            100% { box-shadow: 0 0 50px rgba(255, 255, 255, 0.6); }
        }

        .wish-area {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            width: 100%;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .wish-input {
            width: 100%;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            color: white;
            font-size: 1rem;
            margin-bottom: 1rem;
            outline: none;
            transition: all 0.3s ease;
        }

        .wish-input:focus {
            border-color: #8a2be2;
            box-shadow: 0 0 20px rgba(138, 43, 226, 0.4);
        }

        .wish-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .wish-btn {
            width: 100%;
            padding: 1rem;
            background: linear-gradient(45deg, #8a2be2, #4169e1);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .wish-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(138, 43, 226, 0.4);
        }

        .wish-btn:active {
            transform: translateY(0);
        }

        .wishes-container {
            width: 100%;
            max-width: 600px;
            max-height: 300px;
            overflow-y: auto;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            backdrop-filter: blur(5px);
        }

        .wish-item {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1rem;
            color: white;
            position: relative;
            overflow: hidden;
            animation: wishAppear 0.5s ease-out;
        }

        .wish-item.completed {
            background: rgba(255, 215, 0, 0.15);
            border-color: rgba(255, 215, 0, 0.3);
        }

        .wish-item.completed .wish-text {
            text-decoration: line-through;
            opacity: 0.8;
        }

        @keyframes wishAppear {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .wish-text {
            font-size: 1rem;
            line-height: 1.4;
            margin-bottom: 0.5rem;
            padding-right: 80px;
        }

        .wish-time {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.6);
            text-align: right;
        }

        .wish-controls {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .complete-btn, .delete-btn {
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            color: white;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }

        .complete-btn {
            background: rgba(100, 255, 100, 0.3);
        }

        .complete-btn:hover {
            background: rgba(100, 255, 100, 0.6);
            transform: scale(1.1);
        }

        .delete-btn {
            background: rgba(255, 100, 100, 0.3);
        }

        .delete-btn:hover {
            background: rgba(255, 100, 100, 0.6);
            transform: scale(1.1);
        }

        .wish-stats {
            position: absolute;
            top: 20px;
            left: 20px;
            color: white;
            font-size: 0.9rem;
            background: rgba(255, 255, 255, 0.1);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            backdrop-filter: blur(5px);
        }

        .wish-counter {
            display: inline-block;
            margin-right: 1rem;
        }

        .enter-hint {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.5);
            text-align: center;
            margin-top: 0.5rem;
        }

        .empty-wishes {
            text-align: center;
            color: rgba(255, 255, 255, 0.6);
            font-style: italic;
            margin: 2rem 0;
        }

        .magical-particles {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .particle {
            position: absolute;
            width: 3px;
            height: 3px;
            background: #ffd700;
            border-radius: 50%;
            animation: floatUp 4s ease-out infinite;
        }

        @keyframes floatUp {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-100px) scale(0.3);
            }
        }

        .wish-sparkle {
            position: absolute;
            right: 45px;
            top: 10px;
            font-size: 1.2rem;
            animation: sparkle 1.5s ease-in-out infinite;
        }

        @keyframes sparkle {
            0%, 100% { opacity: 0; transform: scale(0.5) rotate(0deg); }
            50% { opacity: 1; transform: scale(1) rotate(180deg); }
        }

        .constellation {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .constellation-line {
            position: absolute;
            background: rgba(255, 255, 255, 0.3);
            height: 1px;
            transform-origin: left center;
            animation: drawLine 2s ease-in-out infinite;
        }

        @keyframes drawLine {
            0% { width: 0; opacity: 0; }
            50% { opacity: 1; }
            100% { width: 100%; opacity: 0.3; }
        }

        .star-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95);
            color: #333;
            padding: 2rem;
            border-radius: 20px;
            text-align: center;
            max-width: 350px;
            z-index: 1000;
            animation: messageAppear 0.5s ease-out;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        @keyframes messageAppear {
            from {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .message-close {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }

        .backup-controls {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
        }

        .backup-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }

        .backup-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .file-input {
            display: none;
        }

        .install-prompt {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(138, 43, 226, 0.9);
            color: white;
            padding: 1rem 2rem;
            border-radius: 25px;
            text-align: center;
            z-index: 1000;
            animation: slideUp 0.5s ease-out;
            backdrop-filter: blur(10px);
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(100px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        .install-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 15px;
            cursor: pointer;
            margin: 0.5rem;
            transition: all 0.3s ease;
        }

        .install-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        @media (max-width: 768px) {
            .title {
                font-size: 2rem;
            }
            
            .container {
                padding: 1rem;
            }
            
            .wish-area {
                padding: 1.5rem;
            }
            
            .wishes-container {
                max-height: 250px;
            }
            
            .wish-stats {
                font-size: 0.8rem;
                padding: 0.4rem 0.8rem;
            }
            
            .backup-controls {
                flex-direction: column;
                gap: 5px;
            }
            
            .backup-btn {
                padding: 0.4rem 0.8rem;
                font-size: 0.7rem;
            }

            .install-prompt {
                bottom: 10px;
                left: 10px;
                right: 10px;
                transform: none;
                padding: 0.8rem 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="stars" id="stars"></div>
    <div class="moon"></div>
    <div class="constellation" id="constellation"></div>
    <div class="magical-particles" id="particles"></div>
    <div class="wish-stats">
        <span class="wish-counter">å¿ƒæ„¿: <span id="wishCount">0</span></span>
        <span class="wish-counter">å®ç°: <span id="completedCount">0</span></span>
        <span>âœ¨ æ¯ä¸ªå¿ƒæ„¿éƒ½ä¼šè¢«æ˜Ÿæ˜Ÿè®°ä½</span>
    </div>

    <div class="container">
        <h1 class="title">æ˜Ÿç©ºè®¸æ„¿ âœ¨</h1>
        <p class="subtitle">åœ¨è¿™ç‰‡æ˜Ÿç©ºä¸‹ï¼Œè®¸ä¸‹ä½ çš„å¿ƒæ„¿å§ï½æµæ˜Ÿä¼šæŠŠå®ƒä»¬å¸¦åˆ°å®‡å®™çš„å¦ä¸€ç«¯</p>
        
        <div class="wish-area">
            <input type="text" class="wish-input" id="wishInput" placeholder="åœ¨è¿™é‡Œå†™ä¸‹ä½ çš„å¿ƒæ„¿..." maxlength="100">
            <button class="wish-btn" onclick="makeWish()">
                <span>å‘æ˜Ÿç©ºè®¸æ„¿ ğŸŒŸ</span>
            </button>
            <div class="enter-hint">æŒ‰ Enter é”®ä¹Ÿå¯ä»¥è®¸æ„¿å“¦ âœ¨</div>
        </div>

        <div class="wishes-container">
            <div class="empty-wishes" id="emptyWishes">è¿˜æ²¡æœ‰è®¸æ„¿å“¦ï½å¿«å†™ä¸‹ä½ çš„ç¬¬ä¸€ä¸ªå¿ƒæ„¿å§ï¼</div>
            <div id="wishesList"></div>
        </div>
    </div>

    <div class="backup-controls">
        <button class="backup-btn" onclick="exportWishes()">ğŸ“¤ å¯¼å‡ºå¿ƒæ„¿</button>
        <button class="backup-btn" onclick="document.getElementById('importInput').click()">ğŸ“¥ å¯¼å…¥å¿ƒæ„¿</button>
        <input type="file" id="importInput" class="file-input" accept=".json" onchange="importWishes(event)">
    </div>

    <script>
        let wishes = [];
        let starCount = 150;
        let shootingStarInterval;
        let particleInterval;
        let deferredPrompt;
        let starMessages = [
            "ğŸŒŸ æ˜Ÿç©ºå¬åˆ°äº†ä½ çš„å¿ƒæ„¿ï¼Œæ­£åœ¨ä¸ºä½ å‡†å¤‡æƒŠå–œ...",
            "âœ¨ æµæ˜Ÿå‘Šè¯‰æˆ‘ï¼Œä½ çš„æ„¿æœ›å¾ˆç¾å¥½å‘¢ï¼",
            "ğŸŒ™ æœˆäº®è¯´ï¼ŒåšæŒä¸‹å»ï¼Œæ„¿æœ›ä¼šå®ç°çš„ï¼",
            "ğŸ’« å®‡å®™çš„å¦ä¸€ç«¯ï¼Œæœ‰äººæ­£åœ¨ä¸ºä½ çš„æ¢¦æƒ³åŠ æ²¹ï¼",
            "ğŸŒŸ æ˜Ÿæ˜Ÿä»¬åœ¨çªƒçªƒç§è¯­ï¼Œè¯´ä½ ä»Šå¤©ç‰¹åˆ«é—ªäº®ï¼",
            "âœ¨ é“¶æ²³ç³»é‚®é€’å‘˜åˆšåˆšé€æ¥äº†ä¸€ä»½å¥½è¿ï½",
            "ğŸŒ™ ä»Šå¤œçš„æ˜Ÿç©ºæ ¼å¤–æ¸©æŸ”ï¼Œå°±åƒä½ çš„å¿ƒæ„¿ä¸€æ ·ï¼",
            "ğŸŒŸ åŒ—ææ˜Ÿç‚¹å¤´è¡¨ç¤ºï¼Œä½ çš„æ„¿æœ›å·²ç»ç™»è®°æˆåŠŸï¼",
            "ğŸ’« æµæ˜Ÿé›¨è¯´ï¼Œä»Šå¤©æ˜¯ä¸ªè®¸æ„¿çš„å¥½æ—¥å­ï¼",
            "âœ¨ å¤©ç©ºä¸­çš„äº‘æœµéƒ½åœ¨ä¸ºä½ çš„æ¢¦æƒ³é¼“æŒï¼"
        ];

        // PWAå®‰è£…æç¤º
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            showInstallPrompt();
        });

        function showInstallPrompt() {
            const installPrompt = document.createElement('div');
            installPrompt.className = 'install-prompt';
            installPrompt.innerHTML = `
                <div>ğŸŒŸ æŠŠæ˜Ÿç©ºè®¸æ„¿æ·»åŠ åˆ°ä¸»å±å¹•</div>
                <div style="font-size: 0.8rem; margin: 0.5rem 0;">åƒçœŸæ­£çš„Appä¸€æ ·ä½¿ç”¨ï¼</div>
                <button class="install-btn" onclick="installApp()">âœ¨ å®‰è£…åº”ç”¨</button>
                <button class="install-btn" onclick="this.parentElement.remove()">ç¨åå†è¯´</button>
            `;
            document.body.appendChild(installPrompt);
            
            setTimeout(() => {
                if (installPrompt.parentElement) {
                    installPrompt.remove();
                }
            }, 10000);
        }

        async function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') {
                    showStarMessage('ğŸ‰ å®‰è£…æˆåŠŸï¼ç°åœ¨å¯ä»¥ä»ä¸»å±å¹•è®¿é—®æ˜Ÿç©ºè®¸æ„¿äº†ï¼');
                }
                deferredPrompt = null;
            }
            document.querySelector('.install-prompt')?.remove();
        }

        // ä»æœ¬åœ°å­˜å‚¨åŠ è½½å¿ƒæ„¿
        function loadWishes() {
            try {
                const savedWishes = localStorage.getItem('starryWishes');
                if (savedWishes) {
                    wishes = JSON.parse(savedWishes);
                    displayWishes();
                    updateWishCount();
                } else {
                    wishes = [];
                }
            } catch (e) {
                console.log('åŠ è½½å¿ƒæ„¿å¤±è´¥ï¼Œä½¿ç”¨ç©ºåˆ—è¡¨');
                wishes = [];
            }
        }

        // ä¿å­˜å¿ƒæ„¿åˆ°æœ¬åœ°å­˜å‚¨
        function saveWishes() {
            try {
                localStorage.setItem('starryWishes', JSON.stringify(wishes));
            } catch (e) {
                console.log('ä¿å­˜å¿ƒæ„¿å¤±è´¥');
                showStarMessage('ğŸ’« ä¿å­˜å¤±è´¥ï¼Œè¯·æ£€æŸ¥å­˜å‚¨ç©ºé—´æ˜¯å¦è¶³å¤Ÿï½');
            }
        }

        // åˆ›å»ºæ˜Ÿç©º
        function createStars() {
            const starsContainer = document.getElementById('stars');
            starsContainer.innerHTML = '';
            
            for (let i = 0; i < starCount; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                
                // éšæœºåˆ›å»ºä¸€äº›é‡‘è‰²çš„æ˜Ÿæ˜Ÿ
                if (Math.random() < 0.1) {
                    star.classList.add('golden');
                }
                
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.width = Math.random() * 3 + 1 + 'px';
                star.style.height = star.style.width;
                star.style.animationDelay = Math.random() * 2 + 's';
                starsContainer.appendChild(star);
            }
        }

        // åˆ›å»ºæµæ˜Ÿ
        function createShootingStar() {
            const shootingStar = document.createElement('div');
            shootingStar.className = 'shooting-star';
            shootingStar.style.left = Math.random() * 100 + '%';
            shootingStar.style.top = Math.random() * 50 + '%';
            shootingStar.style.animationDuration = Math.random() * 2 + 2 + 's';
            
            const trail = document.createElement('div');
            trail.style.position = 'absolute';
            trail.style.width = '50px';
            trail.style.height = '1px';
            trail.style.background = 'linear-gradient(90deg, transparent, white, transparent)';
            trail.style.left = '-25px';
            trail.style.top = '0';
            shootingStar.appendChild(trail);

            document.getElementById('stars').appendChild(shootingStar);

            setTimeout(() => {
                shootingStar.remove();
            }, 3000);
        }

        // åˆ›å»ºé­”æ³•ç²’å­æ•ˆæœ
        function createMagicalEffect() {
            const particles = document.getElementById('particles');
            for (let i = 0; i < 20; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 2 + 's';
                particles.appendChild(particle);

                setTimeout(() => {
                    particle.remove();
                }, 4000);
            }
        }

        // æ˜¾ç¤ºæ˜Ÿç©ºæ¶ˆæ¯
        function showStarMessage(customMessage = null) {
            const message = customMessage || starMessages[Math.floor(Math.random() * starMessages.length)];
            
            // ç§»é™¤å·²å­˜åœ¨çš„æ¶ˆæ¯
            document.querySelectorAll('.star-message').forEach(msg => msg.remove());
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'star-message';
            messageDiv.innerHTML = `
                <button class="message-close" onclick="this.parentElement.remove()">Ã—</button>
                <div style="font-size: 1.2rem; margin-bottom: 1rem;">${message}</div>
                <div style="font-size: 0.9rem; color: #666;">â€” æ¥è‡ªæ˜Ÿç©ºçš„æ‚„æ‚„è¯</div>
            `;
            document.body.appendChild(messageDiv);
            
            setTimeout(() => {
                if (messageDiv.parentElement) {
                    messageDiv.remove();
                }
            }, 5000);
        }

        // è®¸æ„¿åŠŸèƒ½
        function makeWish() {
            const wishInput = document.getElementById('wishInput');
            const wishText = wishInput.value.trim();
            
            if (wishText) {
                const wish = {
                    text: wishText,
                    time: new Date().toLocaleString('zh-CN'),
                    id: Date.now(),
                    completed: false
                };
                
                wishes.unshift(wish);
                wishInput.value = '';
                
                saveWishes();
                displayWishes();
                updateWishCount();
                createMagicalEffect();
                createShootingStar();
                
                document.getElementById('emptyWishes').style.display = 'none';
                showWishSuccess();
                
                // éšæœºæ˜¾ç¤ºæ˜Ÿç©ºæ¶ˆæ¯
                setTimeout(() => {
                    if (Math.random() < 0.4) { // 40%æ¦‚ç‡æ˜¾ç¤ºæ¶ˆæ¯
                        showStarMessage();
                    }
                }, 2000);
            }
        }

        // æ˜¾ç¤ºè®¸æ„¿æˆåŠŸåé¦ˆ
        function showWishSuccess() {
            const button = document.querySelector('.wish-btn');
            const originalBg = button.style.background;
            const originalContent = button.innerHTML;
            
            button.style.background = 'linear-gradient(45deg, #ffd700, #ff6b6b)';
            button.innerHTML = '<span>âœ¨ å¿ƒæ„¿å·²é€è¾¾æ˜Ÿç©º âœ¨</span>';
            
            setTimeout(() => {
                button.style.background = 'linear-gradient(45deg, #8a2be2, #4169e1)';
                button.innerHTML = '<span>å‘æ˜Ÿç©ºè®¸æ„¿ ğŸŒŸ</span>';
            }, 1500);
        }

        // å®Œæˆå¿ƒæ„¿
        function completeWish(id) {
            const wish = wishes.find(w => w.id === id);
            if (wish) {
                wish.completed = !wish.completed;
                saveWishes();
                displayWishes();
                updateWishCount();
                
                if (wish.completed) {
                    createMagicalEffect();
                    setTimeout(() => {
                        showStarMessage('ğŸ‰ æ­å–œä½ ï¼åˆä¸€ä¸ªå¿ƒæ„¿è¾¾æˆäº†ï¼æ˜Ÿç©ºä¸ºä½ æ„Ÿåˆ°éª„å‚²ï¼');
                    }, 1000);
                }
            }
        }

        // æ˜¾ç¤ºè®¸æ„¿åˆ—è¡¨
        function displayWishes() {
            const wishesList = document.getElementById('wishesList');
            wishesList.innerHTML = '';
            
            wishes.forEach(wish => {
                const wishItem = document.createElement('div');
                wishItem.className = `wish-item ${wish.completed ? 'completed' : ''}`;
                wishItem.innerHTML = `
                    <div class="wish-sparkle">${wish.completed ? 'ğŸŒŸ' : 'âœ¨'}</div>
                    <div class="wish-text">${wish.completed ? 'ğŸŒŸ' : 'âœ¨'} ${wish.text}</div>
                    <div class="wish-time">${wish.time}</div>
                    <div class="wish-controls">
                        <button class="complete-btn" onclick="completeWish(${wish.id})" title="${wish.completed ? 'æ ‡è®°ä¸ºæœªå®Œæˆ' : 'æ ‡è®°ä¸ºå·²å®Œæˆ'}">
                            ${wish.completed ? 'â†¶' : 'âœ“'}
                        </button>
                        <button class="delete-btn" onclick="deleteWish(${wish.id})" title="åˆ é™¤å¿ƒæ„¿">
                            Ã—
                        </button>
                    </div>
                `;
                wishesList.appendChild(wishItem);
            });
            
            document.getElementById('emptyWishes').style.display = wishes.length === 0 ? 'block' : 'none';
        }

        // åˆ é™¤å¿ƒæ„¿
        function deleteWish(id) {
            const index = wishes.findIndex(w => w.id === id);
            if (index > -1) {
                wishes.splice(index, 1);
                saveWishes();
                displayWishes();
                updateWishCount();
                
                if (wishes.length === 0) {
                    document.getElementById('emptyWishes').style.display = 'block';
                }
            }
        }

        // æ›´æ–°å¿ƒæ„¿è®¡æ•°
        function updateWishCount() {
            const totalWishes = wishes.length;
            const completedWishes = wishes.filter(w => w.completed).length;
            
            document.getElementById('wishCount').textContent = totalWishes;
            document.getElementById('completedCount').textContent = completedWishes;
        }

        // å¯¼å‡ºå¿ƒæ„¿
        function exportWishes() {
            if (wishes.length === 0) {
                showStarMessage('ğŸ’« è¿˜æ²¡æœ‰å¿ƒæ„¿å¯ä»¥å¯¼å‡ºå“¦ï½å…ˆè®¸ä¸ªæ„¿å§ï¼');
                return;
            }
            
            const dataStr = JSON.stringify(wishes, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `æˆ‘çš„æ˜Ÿç©ºå¿ƒæ„¿_${new Date().toLocaleDateString('zh-CN').replace(/\//g, '-')}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            URL.revokeObjectURL(url);
            showStarMessage('ğŸ“¤ å¿ƒæ„¿å·²å¯¼å‡ºï¼è®°å¾—å¥½å¥½ä¿ç®¡å“¦ï½');
        }

        // å¯¼å…¥å¿ƒæ„¿
        function importWishes(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedWishes = JSON.parse(e.target.result);
                    if (Array.isArray(importedWishes)) {
                        // åˆå¹¶å¿ƒæ„¿ï¼Œé¿å…é‡å¤
                        const existingIds = new Set(wishes.map(w => w.id));
                        const newWishes = importedWishes.filter(w => !existingIds.has(w.id));
                        
                        wishes = [...newWishes, ...wishes];
                        saveWishes();
                        displayWishes();
                        updateWishCount();
                        
                        showStarMessage(`ğŸ“¥ æˆåŠŸå¯¼å…¥ ${newWishes.length} ä¸ªå¿ƒæ„¿ï¼æ¬¢è¿å›æ¥ï½`);
                    } else {
                        showStarMessage('ğŸ’« æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·é€‰æ‹©æ­£ç¡®çš„å¿ƒæ„¿æ–‡ä»¶ï½');
                    }
                } catch (error) {
                    showStarMessage('ğŸ’« å¯¼å…¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®ï½');
                }
            };
            reader.readAsText(file);
            
            // æ¸…ç©ºæ–‡ä»¶è¾“å…¥
            event.target.value = '';
        }

        // åˆ›å»ºæ˜Ÿåº§è¿çº¿æ•ˆæœ
        function createConstellation() {
            const constellation = document.getElementById('constellation');
            constellation.innerHTML = '';
            
            // åˆ›å»ºå‡ æ¡éšæœºçš„æ˜Ÿåº§è¿çº¿
            for (let i = 0; i < 5; i++) {
                const line = document.createElement('div');
                line.className = 'constellation-line';
                line.style.left = Math.random() * 80 + '%';
                line.style.top = Math.random() * 80 + '%';
                line.style.width = Math.random() * 100 + 50 + 'px';
                line.style.transform = `rotate(${Math.random() * 360}deg)`;
                line.style.animationDelay = Math.random() * 3 + 's';
                constellation.appendChild(line);
            }
        }

        // é”®ç›˜äº‹ä»¶ç›‘å¬
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && document.activeElement.id === 'wishInput') {
                makeWish();
            }
        });

        // é¡µé¢åŠ è½½æ—¶çš„åˆå§‹åŒ–
        window.addEventListener('load', function() {
            loadWishes();
            createStars();
            createConstellation();
            updateWishCount();
            
            // å®šæœŸåˆ›å»ºæµæ˜Ÿ
            shootingStarInterval = setInterval(createShootingStar, 8000);
            
            // å®šæœŸåˆ›å»ºé­”æ³•ç²’å­
            particleInterval = setInterval(() => {
                if (Math.random() < 0.3) {
                    createMagicalEffect();
                }
            }, 15000);
            
            // å®šæœŸé‡æ–°åˆ›å»ºæ˜Ÿåº§
            setInterval(createConstellation, 20000);
            
            // æ¬¢è¿æ¶ˆæ¯
            setTimeout(() => {
                if (wishes.length === 0) {
                    showStarMessage('ğŸŒŸ æ¬¢è¿æ¥åˆ°æ˜Ÿç©ºè®¸æ„¿ï¼åœ¨è¿™é‡Œï¼Œæ¯ä¸ªå¿ƒæ„¿éƒ½ä¼šè¢«æ˜Ÿæ˜Ÿè®°ä½ï½');
                } else {
                    showStarMessage('ğŸŒŸ æ¬¢è¿å›æ¥ï¼æ˜Ÿç©ºä¸€ç›´åœ¨ç­‰ç€ä½ ï½');
                }
            }, 2000);
        });

        // é¡µé¢å¸è½½æ—¶æ¸…ç†
        window.addEventListener('beforeunload', function() {
            if (shootingStarInterval) {
                clearInterval(shootingStarInterval);
            }
            if (particleInterval) {
                clearInterval(particleInterval);
            }
        });

        // æ³¨å†ŒService Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('data:text/javascript;base64,Y29uc3QgQ0FDSEVfTkFNRSA9ICdzdGFycnktd2lzaGVzLXYxJzsKY29uc3QgdXJsc1RvQ2FjaGUgPSBbCiAgJy4nLAogICcuL2luZGV4Lmh0bWwnCl07CgpzZWxmLmFkZEV2ZW50TGlzdGVuZXIoJ2luc3RhbGwnLCBmdW5jdGlvbihldmVudCkgewogIGV2ZW50LndhaXRVbnRpbCgKICAgIGNhY2hlcy5vcGVuKENBQ0hFX05BTUUpCiAgICAgIC50aGVuKGZ1bmN0aW9uKGNhY2hlKSB7CiAgICAgICAgcmV0dXJuIGNhY2hlLmFkZEFsbCh1cmxzVG9DYWNoZSk7CiAgICAgIH0pCiAgKTsKfSk7CgpzZWxmLmFkZEV2ZW50TGlzdGVuZXIoJ2ZldGNoJywgZnVuY3Rpb24oZXZlbnQpIHsKICBldmVudC5yZXNwb25kV2l0aCgKICAgIGNhY2hlcy5tYXRjaChldmVudC5yZXF1ZXN0KQogICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSkgewogICAgICAgIGlmIChyZXNwb25zZSkgewogICAgICAgICAgcmV0dXJuIHJlc3BvbnNlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmV0Y2goZXZlbnQucmVxdWVzdCk7CiAgICAgIH0pCiAgKTsKfSk7')
                .then(function(registration) {
                    console.log('Service Worker æ³¨å†ŒæˆåŠŸ');
                }, function(err) {
                    console.log('Service Worker æ³¨å†Œå¤±è´¥');
                });
            });
        }

        // æ·»åŠ ä¸€äº›ç‰¹æ®Šçš„æ˜Ÿç©ºäº’åŠ¨
        let clickCount = 0;
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('star') || e.target.classList.contains('moon')) {
                clickCount++;
                if (clickCount % 7 === 0) {
                    showStarMessage('ğŸŒŸ ä½ å‘ç°äº†æ˜Ÿç©ºçš„å°ç§˜å¯†ï¼è¿ç»­ç‚¹å‡»æ˜Ÿæ˜Ÿä¼šæœ‰æƒŠå–œå“¦ï½');
                    createMagicalEffect();
                    createShootingStar();
                }
            }
        });

        // æ·»åŠ å¤œæ™šæ¨¡å¼æ£€æµ‹
        function checkNightMode() {
            const hour = new Date().getHours();
            if (hour >= 20 || hour <= 6) {
                document.body.style.filter = 'brightness(0.9)';
                setTimeout(() => {
                    if (Math.random() < 0.2) {
                        showStarMessage('ğŸŒ™ æ·±å¤œäº†ï¼Œæ˜Ÿç©ºæ ¼å¤–ç¾ä¸½å‘¢ï½è®°å¾—æ—©ç‚¹ä¼‘æ¯å“¦ï¼');
                    }
                }, 30000);
            }
        }

        // æ¯30ç§’æ£€æŸ¥ä¸€æ¬¡æ—¶é—´
        setInterval(checkNightMode, 30000);
        checkNightMode();

        // æ·»åŠ å¿ƒæ„¿æé†’åŠŸèƒ½
        function wishReminder() {
            const lastWishTime = localStorage.getItem('lastWishTime');
            const now = Date.now();
            const oneDay = 24 * 60 * 60 * 1000;
            
            if (!lastWishTime || now - parseInt(lastWishTime) > oneDay) {
                setTimeout(() => {
                    if (Math.random() < 0.3) {
                        showStarMessage('ğŸ’« å¥½ä¹…æ²¡æœ‰æ–°çš„å¿ƒæ„¿äº†ï¼Œä»Šå¤©æœ‰ä»€ä¹ˆæƒ³è®¸çš„å—ï¼Ÿ');
                    }
                }, 60000);
            }
        }

        // å½“è®¸æ„¿æ—¶æ›´æ–°æ—¶é—´
        const originalMakeWish = makeWish;
        makeWish = function() {
            localStorage.setItem('lastWishTime', Date.now().toString());
            originalMakeWish();
        };

        // åˆå§‹åŒ–æé†’
        wishReminder();
    </script>
</body>
</html>